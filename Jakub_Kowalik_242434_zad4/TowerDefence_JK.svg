<?xml version="1.0" encoding="UTF-8"?>
<svg  xmlns="http://www.w3.org/2000/svg" id="svg"
      xmlns:html="http://www.w3.org/1999/xhtml">
    <title>TowerDefenceJK</title>

    <rect id="mainWindow" width="100%" height="100%" fill="white"/>
    <rect id="info" x="75%" width="25%" height="100%" fill="#8D8B92" stroke="black" stroke-width="5px"/>
    <rect id="game" width="75%" height="100%" fill="#040112"/>
    <image id="battle" href="bitwa.png" y="0" width="75%" height="100%"/>
    <rect id="tower" width="75%" height="15%" fill="#636268" y="700"/>
    <rect id="myHp" width="300" height="5%" fill="green" x="77%" y="10%"  stroke="black" stroke-width="3px"/>
    <rect id="lostHp" width="0" height="5%" fill="red" x="77%" y="10%"  stroke="black" stroke-width="3px"/>
    <rect class="rect" x="78%" y="70%" width="20%" height="25%" fill="#FFEBCD" rx="20" ry="20" stroke="black" stroke-width="3px"/>
    <rect class="rect" x="78%" y="34%" width="20%" height="25%" fill="#FFEBCD" rx="20" ry="20" stroke="black" stroke-width="3px"/>

    <circle id="bullet1" cx="616" cy="540" r="12" stroke="black" fill="#ff3d3d"/>
    <circle id="bullet2" cx="690" cy="540" r="12" stroke="black" fill="#ff3d3d"/>

    <foreignObject style="height:80px;width:120px;" x="1250" y="140" fill="red">
        <html:button class="button" onclick="play()">START</html:button>
    </foreignObject>
    <foreignObject style="height:80px;width:120px;" x="1250" y="200" fill="red">
        <html:button class="button" onclick="pause()">PAUZA</html:button>
    </foreignObject>

    <image id="soldier" href="dzialko.png" x="550" y="500"/>
    <image id="bomb" href="atak.png" y="-250" width="220"/>
    <image id="bum" href="wybuch.png" y="-250" width="270" height="250"/>
    <image id="heal" href="apteczka.png" x="100" y="-700" width="170" height="170"/>
    <image id="shootBoost" href="shootBoost.png" x="200" y="-1200" width="170" height="170"/>
    <image id="movementBoost" href="moveBoost.png" x="300" y="-1700" width="170" height="170"/>

    <text x="83%" y="78%" font-size="25px">STEROWANIE</text>
    <text x="86%" y="8%" font-size="25px" fill="black">HP</text>
    <text x="82%" y="84%" font-size="18px">A/strzalka w lewo - lewo</text>
    <text x="82%" y="86%" font-size="18px">D/strzalka w prawo - prawo</text>
    <text x="82%" y="90%" font-size="18px">Shift- strzał</text>
    <text x="83%" y="40%" font-size="40">WYNIK</text>
    <text x="86%" y="53%" font-size="60" id="score"> </text>

    <rect id="endWindow" width="100%" height="100%" fill="black" x="-155%" y="-155%"/>
    <text x="-200" y="-200" fill="red" font-size="60" id="endText">YOU LOST</text>
    <image id="lostImage" href="lost.png" x="-1220" y="-1460" width="200" height="200">
        <animateMotion dur="8s" repeatCount="indefinite" path="M-220,20 L1250,20"/>
        <animateTransform attributeName="transform" type="rotate" from="0 120 560" to="360 120 560" dur="4s" repeatCount="indefinite"/>
    </image>
    <foreignObject id="restart" style="height:150px;width:220px;" x="-250" y="-600" fill="red" visibility="visible">
        <html:button class="button1" onclick="refresh()">RESTART</html:button>
    </foreignObject>

    <script type="text/ecmascript">
        <![CDATA[
            var soldier = document.getElementById("soldier");
            var bullet1 = document.getElementById("bullet1");
            var bullet2 = document.getElementById("bullet2");
            var bomb = document.getElementById("bomb");
            var movementBoost = document.getElementById("movementBoost");
            var shootBoost = document.getElementById("shootBoost");
            var heal = document.getElementById("heal");
            var myHp = document.getElementById("myHp");
            var bum = document.getElementById("bum");
            var lostHp = document.getElementById("lostHp");
            var endWindow = document.getElementById("endWindow");
            var endText = document.getElementById("endText");
            var lostImage = document.getElementById("lostImage");
            var counter = 0;
            var attackSpeed = 2;
            var shootSpeed = 2;
            var movementSpeed = 13;
            var x = Math.floor(Math.random() * 930);
            var isActive = false;
            var restart = document.getElementById("restart");
            let start;

            function pause() {
                alert("Zapauzowałeś swoją grę, ale wracaj szybko bo sama się nie dogra ;)");
            }

            function refresh() {
                window.location.reload()
            }

            function play() {
                if(!isActive) {
                    setTimeout(attack, 2);
                    setTimeout(boost.bind(null, heal), 7000);
                    setTimeout(boost.bind(null, movementBoost), 16000);
                    setTimeout(boost.bind(null, shootBoost), 24000);
                    window.addEventListener('keydown', move);
                    showScore();
                    isActive = true;
                }
            }

            function attack() {
                bomb.x.baseVal.value = x;
                bomb.y.baseVal.value += attackSpeed;
                if(bomb.y.baseVal.value+160 >= 740) {
                   bomb.y.baseVal.value = -250;
                   x = Math.floor(Math.random() * 930);
                   bomb.x.baseVal.value = x;
                   lostHp.width.baseVal.value += 30;
                }
                if(counter < 5) attackSpeed = 1;
                else if(counter <25) attackSpeed = 2;
                else if(counter <50) attackSpeed = 3;
                else if(counter <75) attackSpeed = 4;
                else attackSpeed = 5;
                setTimeout(attack, 5);
                gameOver();
            }

            function gameOver() {
                if(lostHp.width.baseVal.value == 300) {
                   endWindow.x.baseVal.value = 0;
                   endWindow.y.baseVal.value = 0;
                   endText.setAttribute("x", 300);
                   endText.setAttribute("y", 300);
                   endText.setAttribute("font-size", 160);
                   lostImage.setAttribute("x", 20);
                   lostImage.setAttribute("y", 460);
                   restart.setAttribute("x", 500);
                   restart.setAttribute("y", 400);
                }
            }

            function boost(object) {
                object.y.baseVal.value += 2;
                var xPosition = Math.floor(Math.random() * 930);
                setTimeout(boost.bind(null, object, xPosition), 50);
                if(object.y.baseVal.value + 170 == 740) {
                    object.y.baseVal.value = -850;
                    xPosition = Math.floor(Math.random() * 930);
                    object.x.baseVal.value = xPosition;
                }
                hitBoost(object, xPosition);
            }

            function hitBoost(object, xPosition) {
                if(bullet1.cy.baseVal.value <= object.y.baseVal.value+170
                   && bullet1.cy.baseVal.value >= object.y.baseVal.value+80
                   && bullet1.cx.baseVal.value >= object.x.baseVal.value
                   && bullet1.cx.baseVal.value <= object.x.baseVal.value+170) {
                       hitBoostHelp(object);
                }
                if(bullet2.cy.baseVal.value <= object.y.baseVal.value+170
                   && bullet2.cy.baseVal.value >= object.y.baseVal.value+80
                   && bullet2.cx.baseVal.value >= object.x.baseVal.value
                   && bullet2.cx.baseVal.value <= object.x.baseVal.value+170) {
                       hitBoostHelp(object);
                }
            }

            function hitBoostHelp(object) {
                clearInterval(start);
                start = null;
                bullet1.cy.baseVal.value = 540;
                bullet2.cy.baseVal.value = 540;
                object.y.baseVal.value = -850;
                var xPosition = Math.floor(Math.random() * 930);
                object.x.baseVal.value = xPosition;
                if(object == heal)  lostHp.width.baseVal.value -= 30;
                if(object == shootBoost)  shootSpeed += 0.5;
                if(object == movementBoost)  movementSpeed += 2;
            }

            function move(e) {
                switch (e.keyCode) {
                case 65:
                    leftPressed();
                break;
                case 37:
                    leftPressed();
                break;
                case 68 :
                    rightPressed();
                break;
                case 39 :
                    rightPressed();
                break;
                case 16 :
                    if(!start) {
                        start = setInterval('shoot()', 0);
                     }
                break;
                }
            }

            function rightPressed() {
                var x = soldier.x.baseVal.value;
                var xb1 = bullet1.cx.baseVal.value;
                var xb2 = bullet2.cx.baseVal.value;
                x += movementSpeed;
                xb1 += movementSpeed;
                xb2 += movementSpeed;
                if(x > 930) {
                    x = 930;
                    xb1 = 1000;
                    xb2 = 1070;
                }
                bullet1.cx.baseVal.value = xb1;
                bullet2.cx.baseVal.value = xb2;
                soldier.x.baseVal.value = x;
            }

            function leftPressed() {
                var x = soldier.x.baseVal.value;
                var xb1 = bullet1.cx.baseVal.value;
                var xb2 = bullet2.cx.baseVal.value;
                x -= movementSpeed;
                xb1 -= movementSpeed;
                xb2 -= movementSpeed;
                if(x < 2) {
                    x = 2;
                    xb1 = 72;
                    xb2 = 145;
                }
                bullet1.cx.baseVal.value = xb1;
                bullet2.cx.baseVal.value = xb2;
                soldier.x.baseVal.value = x;
            }

            function shoot() {
                 bullet1.cy.baseVal.value -= shootSpeed;
                 bullet2.cy.baseVal.value -= shootSpeed;
                 hit();
                 endOfArea();
            }

            function endOfArea() {
                if(bullet1.cy.baseVal.value == 20) {
                    clearInterval(start);
                    start = null;
                    bullet1.cy.baseVal.value = 540;
                    bullet2.cy.baseVal.value = 540;
                  }
            }

            function hit() {
                if(bullet1.cy.baseVal.value <= bomb.y.baseVal.value+160
                   && bullet1.cy.baseVal.value >= bomb.y.baseVal.value+80
                   && bullet1.cx.baseVal.value >= bomb.x.baseVal.value
                   && bullet1.cx.baseVal.value <= bomb.x.baseVal.value+220) {
                       hitHelp();
                }
                if(bullet2.cy.baseVal.value <= bomb.y.baseVal.value+160
                   && bullet2.cy.baseVal.value >= bomb.y.baseVal.value+80
                   && bullet2.cx.baseVal.value >= bomb.x.baseVal.value
                   && bullet2.cx.baseVal.value <= bomb.x.baseVal.value+220) {
                       hitHelp();
                }
            }

            function hitHelp(a) {
                clearInterval(start);
                start = null;
                bullet1.cy.baseVal.value = 540;
                bullet2.cy.baseVal.value = 540;
                bum.y.baseVal.value = bomb.y.baseVal.value - 20;
                bum.x.baseVal.value = bomb.x.baseVal.value;
                setTimeout(() => {bum.style.display='none';}, 1000);
                bum.style.display='block';
                bomb.y.baseVal.value = -320;
                counter += 1;
                showScore();
                x = Math.floor(Math.random() * 930);
            }

            function showScore() {
                const score = document.getElementById("score");
                score.firstChild.data = counter;
            }
        ]]>
    </script>
    <style>
        .rect {
            opacity: 0.7;
            border-radius: 30px;
        }

        button.button {
        font-size: 28px;
        cursor: pointer;
        text-align: center;
        color: black;
        background-color: #FFEBCD;
        border: none;
        border-radius: 15px;
        box-shadow: 0 7px #666;
        }
        button.button:hover {
            background-color: #DEB887;
        }
        button.button:active {
        background-color: #DEB887;
        box-shadow: 0 5px #666;
        transform: translateY(4px);
        }

        button.button1 {
        font-size: 28px;
        cursor: pointer;
        text-align: center;
        color: black;
        background-color: red;
        border: none;
        border-radius: 15px;
        box-shadow: 0 7px #666;
        }
    </style>
</svg>